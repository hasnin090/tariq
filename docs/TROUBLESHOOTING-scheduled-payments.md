# ๐ง ุญู ูุดููุฉ: ุงูุฏูุนุงุช ุงููุฌุฏููุฉ ูุง ุชุธูุฑ

## ๐ด ุงููุดููุฉ
ุจุนุฏ ุฅุถุงูุฉ ุญุฌุฒ ุจุฎุทุฉ ุฏูุนุ ุงูุฏูุนุงุช ุงููุงุฏูุฉ ูุง ุชุธูุฑ ูู ุตูุญุฉ ุงูุฏูุนุงุช.

---

## โ ุงูุญู ุงููุงูู (ุฎุทูุฉ ุจุฎุทูุฉ)

### **ุงูุฎุทูุฉ 1: ุชุทุจูู ุฅุตูุงุญ RLS** โ๏ธ **ุฅุฌุจุงุฑู**

1. ุงูุชุญ **Supabase Dashboard** โ **SQL Editor**
2. ุงูุชุญ ุงูููู: `supabase-migrations/FIX-RLS-scheduled-payments.sql`
3. ุงูุณุฎ **ูู ุงููุญุชูู** ูุงูุตูู ูู SQL Editor
4. ุงุถุบุท **Run** (ุฃู F5)
5. ุงูุชุธุฑ ุญุชู ุชุฑู: โ **Success**

**ูุง ูุญุฏุซ:**
- ูุญุฐู ุงูุณูุงุณุงุช ุงููุฏููุฉ ุงููุนุทูุจุฉ
- ูููุดุฆ ุณูุงุณุงุช ุฌุฏูุฏุฉ ุตุญูุญุฉ ุชุณูุญ ุจู INSERT/UPDATE/DELETE
- ูููุนูู RLS ุจุดูู ุตุญูุญ

---

### **ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงููุธุงู** ๐

1. ูู **SQL Editor**ุ ุงูุชุญ: `supabase-migrations/TEST-scheduled-payments-system.sql`
2. ุงูุณุฎ ุงููุญุชูู ูุงูุตูู
3. ุงุถุบุท **Run**
4. ุฑุงุฌุน ุงููุชุงุฆุฌ:

#### โ **ูุฌุจ ุฃู ุชุฑู:**
```
โ scheduled_payments - ููุฌูุฏ
โ RLS - ูููุนูู
โ 4 ุณูุงุณุงุช (select, insert, update, delete)
โ Triggers - ูููุนูู
```

#### โ **ุฅุฐุง ุฑุฃูุช:**
```
โ RLS - ูุนุทูู
โ 0 ุณูุงุณุงุช
```
**ุงูุญู:** ุฃุนุฏ ุชุทุจูู ุงูุฎุทูุฉ 1

---

### **ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ** ๐ฏ

1. ุงูุชุญ ุชุทุจููู
2. ุงุฐูุจ ุฅูู **ุงูุญุฌูุฒุงุช**
3. ุงุถุบุท **ุญุฌุฒ ุฌุฏูุฏ**
4. ุงููุฃ ุงูุจูุงูุงุช:
   - ุงุฎุชุฑ ูุญุฏุฉ (ูุซูุงู: ุณุนุฑ 190,000)
   - ุงุฎุชุฑ ุนููู
   - ุฏูุนุฉ ุญุฌุฒ (ูุซูุงู: 60,000)
   - โ **ูุนูู "ุฎุทุฉ ุงูุฏูุน ุงููุฌุฏููุฉ"**
   - ุงุฎุชุฑ: 5 ุณููุงุชุ ูู ุดูุฑ
5. ุงุถุบุท **ุญูุธ**

---

### **ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุชูุฌุฉ** โจ

#### ูู ุงููุชุตูุญ (Console):
ุงูุชุญ **Developer Tools** โ **Console** ูุงุจุญุซ ุนู:

```javascript
โ Scheduled payments created successfully!
โ Created installments: 60
โ Verified payments count: 60
```

#### ูู ุงููุงุฌูุฉ:
1. ุงุฐูุจ ุฅูู **ุงูุฏูุนุงุช**
2. ุงุจุญุซ ุนู ุงุณู ุงูุนููู
3. ุงุถุบุท ุนูู ุตู ุงูุญุฌุฒ **ูุชูุณูุนู**
4. ูุฌุจ ุฃู ุชุฑู ูุณู: **"ุฌุฏูู ุงูุฏูุนุงุช ุงููุณุชูุจููุฉ"**
5. ุนุฏุฏ ุงูุฏูุนุงุช ุงููุงุฏูุฉ (ูุซูุงู: "60 ุฏูุนุฉ ูุงุฏูุฉ")

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### **ุฎุทุฃ: "row-level security policy"**
```
โ Error: new row violates row-level security policy
```
**ุงูุณุจุจ:** ูู ูุชู ุชุทุจูู ุณูุฑูุจุช ุงูุฅุตูุงุญ  
**ุงูุญู:** ุฃุนุฏ ุชุทุจูู ุงูุฎุทูุฉ 1

---

### **ุฎุทุฃ: "relation does not exist"**
```
โ Error: relation "scheduled_payments" does not exist
```
**ุงูุณุจุจ:** ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช  
**ุงูุญู:** 
1. ุงูุชุญ: `supabase-migrations/add-payment-schedule-system.sql`
2. ุงูุณุฎ **ูู ุงููุญุชูู**
3. ุดุบููู ูู SQL Editor

---

### **ุงูุฏูุนุงุช ูุง ุชุธูุฑ ุฑุบู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก**

**ุชุญูู 1:** ูู ุชู ุฅูุดุงุก ุงูุฏูุนุงุช ูุนูุงูุ
```sql
SELECT COUNT(*) FROM scheduled_payments;
```
- ุฅุฐุง ูุงูุช ุงููุชูุฌุฉ **0** โ ุงููุดููุฉ ูู ุฅูุดุงุก ุงูุฏูุนุงุช (RLS)
- ุฅุฐุง ูุงูุช ุงููุชูุฌุฉ **> 0** โ ุงููุดููุฉ ูู ุนุฑุถ ุงูุฏูุนุงุช

**ุชุญูู 2:** ูู ุตูุญุฉ ุงูุฏูุนุงุช ุชุญููู ุงูุฏูุนุงุช ุงููุฌุฏููุฉุ
- ุงูุชุญ Console ูู ุงููุชุตูุญ
- ุงุจุญุซ ุนู: `๐ Loading scheduled payments`
- ุงุจุญุซ ุนู: `๐ Booking X: Found Y scheduled payments`

**ุงูุญู:**
- ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู (ุงูุตูุงุญูุงุช)
- ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (F5)
- ุงูุชุญ ุตูุญุฉ ุงูุฏูุนุงุช ูู ุฌุฏูุฏ

---

### **ุงูุฏูุนุงุช ุชุธูุฑ ููู ุจุนุฏุฏ ุฎุงุทุฆ**

**ูุซุงู:** ุฃูุดุฃุช ุฎุทุฉ 5 ุณููุงุช (60 ุดูุฑ) ููู ูุธูุฑ 48 ุฏูุนุฉ

**ุงูุณุจุจ:** 
- ุชู ุญุณุงุจ ุงูุฃูุณุงุท ุจูุงุกู ุนูู **ุงููุจูุบ ุงููุชุจูู** (ุจุนุฏ ุฎุตู ุฏูุนุฉ ุงูุญุฌุฒ)
- ุฃู ุชุบููุฑ ูู `paymentFrequencyMonths`

**ุงูุชุญูู:**
```javascript
// ูู Console ุนูุฏ ุฅูุดุงุก ุงูุญุฌุฒ
๐ Remaining Amount: 130000  // (190000 - 60000)
๐ Years: 5
๐ Frequency: 1
โ Created installments: 60  // (5 ุณููุงุช ร 12 ุดูุฑ)
```

---

## ๐ ูุนูููุงุช ุฅุถุงููุฉ

### **ููู ูุนูู ุงููุธุงู:**

1. **ุนูุฏ ุฅูุดุงุก ุญุฌุฒ:**
   - ูุญูุธ ุงูุญุฌุฒ ูู ุฌุฏูู `bookings`
   - ุฅุฐุง ูุงูุช ุฎุทุฉ ุฏูุน ููุนููุฉ โ ูุณุชุฏุนู `generateForBooking`
   - ููุดุฆ ุตููู ูู `scheduled_payments` (60 ุตู ููุฏุฉ 5 ุณููุงุช)
   - ูุญุฏูุซ `bookings` ุจูุนูููุงุช ุงูุฎุทุฉ

2. **ูู ุตูุญุฉ ุงูุฏูุนุงุช:**
   - ุชุญููู ุฌููุน ุงูุญุฌูุฒุงุช ุงููุดุทุฉ/ุงูููุชููุฉ
   - ุชุณุชุฏุนู `getByBookingIds` ูุฌูุจ ุงูุฏูุนุงุช ุงููุฌุฏููุฉ
   - ุชุนุฑุถ ุงูุฏูุนุงุช ุนูุฏ ุชูุณูุน ุตู ุงูุญุฌุฒ

3. **ุนูุฏ ุฅุถุงูุฉ ุฏูุนุฉ ุฌุฏูุฏุฉ:**
   - ูุชู ุฅุฏุฑุงุฌูุง ูู `payments`
   - **Trigger ุชููุงุฆู** ูุฑุจุทูุง ุจุฃูุฑุจ `scheduled_payment` ูุนููุฉ
   - ุชุชุญุฏุซ ุญุงูุฉ ุงูุฏูุนุฉ ุงููุฌุฏููุฉ (pending โ partially_paid โ paid)

---

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ

### **ูู ุตูุญุฉ ุงูุญุฌูุฒุงุช:**
- Progress Bar ูููู ูุนุฑุถ ูุณุจุฉ ุงูุณุฏุงุฏ (%)
- ุฒุฑ "ุฅูุบุงุก" ูุธูุฑ ููุญุฌูุฒุงุช ุงููุดุทุฉ ููุท

### **ูู ุตูุญุฉ ุงูุฏูุนุงุช:**
- ุนูุฏ ุชูุณูุน ุญุฌุฒ ูู ุฎุทุฉ ุฏูุน:
  - ูุณู **"ุฌุฏูู ุงูุฏูุนุงุช ุงููุณุชูุจููุฉ"**
  - ุจุทุงูุงุช ููููุฉ ููู ุฏูุนุฉ:
    - ๐ข ุฃุฎุถุฑ = ูุฏููุน
    - ๐ด ุฃุญูุฑ = ูุชุฃุฎุฑ
    - ๐ก ููุฑูุงูู = ูุฑูุจุงู (ุฎูุงู 7 ุฃูุงู)
    - โช ุฑูุงุฏู = ูุงุฏู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ ุจุนุฏ ุชุทุจูู ุฌููุน ุงูุฎุทูุงุช:

1. **ุตููุฑ ุดุงุดุฉ Console** (Developer Tools) ูุฃุฑุณููุง
2. **ูููุฐ ุณูุฑูุจุช ุงูุงุฎุชุจุงุฑ** ูุฃุฑุณู ุงููุชุงุฆุฌ
3. **ุชุญูู ูู**: ูู ุฃูุช ูุณุฌูู ุฏุฎูู ูู Adminุ

---

## โ Checklist ุณุฑูุน

- [ ] ุชุทุจูู `FIX-RLS-scheduled-payments.sql`
- [ ] ุชุดุบูู `TEST-scheduled-payments-system.sql` - ูู ุงููุญูุตุงุช โ
- [ ] ุฅูุดุงุก ุญุฌุฒ ุชุฌุฑูุจู ุจุฎุทุฉ ุฏูุน
- [ ] ุฑุคูุฉ ุฑุณุงูุฉ: "ุชู ุฅูุดุงุก X ุฏูุนุฉ ูุฌุฏููุฉ ุจูุฌุงุญ ๐"
- [ ] ูุชุญ ุตูุญุฉ ุงูุฏูุนุงุช โ ุชูุณูุน ุงูุญุฌุฒ โ ุฑุคูุฉ ุฌุฏูู ุงูุฏูุนุงุช
- [ ] Progress Bar ูุนุฑุถ ุงููุณุจุฉ ุงูุตุญูุญุฉ

**ุฅุฐุง ุงูุชููุช ุฌููุน ุงูููุงุท โ ุงููุธุงู ูุนูู ุจูุฌุงุญ! ๐**
