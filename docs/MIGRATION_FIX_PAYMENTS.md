# ๐ด ูุดููุฉ ุงูุฏูุนุงุช ุงูุชู ุชุชุฌุงูุฒ ุณุนุฑ ุงููุญุฏุฉ

## ๐ ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุชุดุบูู Migrationุ ุธูุฑ ุฎุทุฃ:
```
ERROR: ุฅุฌูุงูู ุงูุฏูุนุงุช (300000000.00) ูุชุฌุงูุฒ ุณุนุฑ ุงููุญุฏุฉ A7 (190000000.00)
```

**ุงูุณุจุจ:** ุชูุฌุฏ ุจูุงูุงุช ุฎุงุทุฆุฉ ูู ุฌุฏูู `bookings` ุญูุซ `amount_paid` ุฃูุจุฑ ูู ุณุนุฑ ุงููุญุฏุฉ.

---

## โ ุงูุญู ุงูููุทุจููู

### 1๏ธโฃ **ุชู ุชุนุฏูู Migration ุงูุฑุฆูุณู**
ููู `restructure-payments-table.sql` ุงูุขู ูููู **ุชููุงุฆูุงู** ุจู:
- โ ุชูุธูู ุงูุจูุงูุงุช ุงูุฎุงุทุฆุฉ ูุจู ุงููุณุฎ
- โ ุชุตุญูุญ `amount_paid` ููููู ูุณุงููุงู ูุณุนุฑ ุงููุญุฏุฉ
- โ ุนุฑุถ ุฑุณุงุฆู ุชูุถูุญูุฉ ุฃุซูุงุก ุงูุชูููุฐ

### 2๏ธโฃ **ููู ุงุฎุชูุงุฑู ููุชูุธูู ุงููุฏูู**
ููู `01-cleanup-invalid-payments.sql` - **ุงุฎุชูุงุฑู** ุฅุฐุง ุฃุฑุฏุช:
- ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุทุฆุฉ ูุจู ุงูุชุตุญูุญ
- ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุชุตุญูุญ (ุตูุฑ ุฃู ุณุนุฑ ุงููุญุฏุฉ)

---

## ๐ ุงูุขู ููููู ุชุดุบูู Migration ูุจุงุดุฑุฉ!

### ุฎุทูุงุช ุงูุชุดุบูู:
1. ุงูุชุญ **Supabase Dashboard** โ **SQL Editor**
2. ุงูุณุฎ ูุญุชูู `restructure-payments-table.sql`
3. ุงุถุบุท **RUN** โ

**ูุง ุญุงุฌุฉ ูุฎุทูุงุช ุฅุถุงููุฉ!** ุงูููู ุณููุธู ุงูุจูุงูุงุช ุชููุงุฆูุงู ููููู ุงูุชูููุฐ.

---

## ๐ ูุง ุงูุฐู ุณูุญุฏุซุ

ุนูุฏ ุงูุชุดุบูู:
```
โ ุชุตุญูุญ ุฏูุนุฉ ุงููุญุฏุฉ A7 ูู 300,000,000 ุฅูู 190,000,000
โ ูุณุฎ ุงูุฏูุนุงุช ุฅูู ุฌุฏูู payments
โ ุฅูุดุงุก ุงูู Triggers ูุงูู Views
โ ุชูุนูู ุงูุญูุงูุฉ ุงูุชููุงุฆูุฉ
```

---

## ๐ก๏ธ ุงูุญูุงูุฉ ุงููุณุชูุจููุฉ

ุจุนุฏ ุชุดุบูู Migration:
- โ ูู ูููู ุฅุฏุฎุงู ุฏูุนุฉ ุฃูุจุฑ ูู ุณุนุฑ ุงููุญุฏุฉ
- โ ุณูุชู ุฑูุถ ุฃู ูุญุงููุฉ ูุชุฌุงูุฒ ุงูุณุนุฑ
- โ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุณุชุธูุฑ ูููุณุชุฎุฏู

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุฅุฐุง ููุช ุชุฑูุฏ ูุฑุงุฌุนุฉ ุงูุจูุงูุงุช ุฃููุงู:
```sql
-- ุดุบูู ูุฐุง ุงูุงุณุชุนูุงู ูุฑุคูุฉ ุงูุญุฌูุฒุงุช ุงููุชุฃุซุฑุฉ
SELECT 
    b.id,
    u.unit_number,
    u.price as unit_price,
    b.amount_paid,
    (b.amount_paid - u.price) as excess
FROM bookings b
JOIN units u ON b.unit_id = u.id
WHERE b.amount_paid > u.price;
```

### ูุชุตุญูุญ ูุฏูู:
ุฅุฐุง ุฃุฑุฏุช ุชุตุญูุญ ุงูุจูุงูุงุช ุจุทุฑููุฉ ูุฎุชููุฉุ ุดุบูู `01-cleanup-invalid-payments.sql` ุฃููุงู.
