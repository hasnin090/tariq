# ğŸš€ Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø© - Development Roadmap
**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:** 18 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025  
**Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:** 85-90% Ù…ÙƒØªÙ…Ù„ Ù„Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©  
**Ø§Ù„Ù‡Ø¯Ù:** Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ 100% Ø§ÙƒØªÙ…Ø§Ù„ Ù…Ø¹ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
1. [Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø¹Ø§Ø¬Ù„Ø© ÙÙˆØ±ÙŠØ©](#phase-1)
2. [Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©](#phase-2)
3. [Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©](#phase-3)
4. [Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©](#phase-4)
5. [ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° Ù„ÙƒÙ„ Ø¹Ù†ØµØ±](#details)

---

<a name="phase-1"></a>
## ğŸ”¥ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø¹Ø§Ø¬Ù„Ø© ÙÙˆØ±ÙŠØ©
**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:** 1-2 Ø£ÙŠØ§Ù…  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** Ø­Ø±Ø¬Ø© âš ï¸

### âœ… Task 1.1: ØªØ·Ø¨ÙŠÙ‚ RLS Ø¹Ù„Ù‰ Supabase
**Ø§Ù„Ù…Ù„ÙØ§Øª:** `supabase-migrations/FIX-RLS-scheduled-payments.sql`

**Ø§Ù„Ø®Ø·ÙˆØ§Øª:**
1. ÙØªØ­ Supabase Dashboard
2. Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ SQL Editor
3. Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ `FIX-RLS-scheduled-payments.sql`
4. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
5. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©

**Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:**
- âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
- âœ… ØªØ¸Ù‡Ø± 4 Ø³ÙŠØ§Ø³Ø§Øª Ù„ÙƒÙ„ Ø¬Ø¯ÙˆÙ„ (select, insert, update, delete)
- âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¨Ø®Ø·Ø© Ø¯ÙØ¹ Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡ RLS

**Ø§Ù„Ø£Ù‡Ù…ÙŠØ©:** Ø­Ø±Ø¬Ø© - Ø¨Ø¯ÙˆÙ† Ù‡Ø°Ø§ Ù„Ù† ØªØ¹Ù…Ù„ Ø®Ø·Ø· Ø§Ù„Ø¯ÙØ¹

---

### âœ… Task 1.2: ØªÙ†Ø¸ÙŠÙ Console Logs
**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§:**
- `src/services/supabaseService.ts`
- `contexts/AuthContext.tsx`
- `components/pages/sales/Bookings.tsx`
- `components/pages/sales/Payments.tsx`
- `utils/*.ts`

**Ø§Ù„Ø®Ø·ÙˆØ§Øª:**
```typescript
// Ø®ÙŠØ§Ø± 1: Ø¥Ø²Ø§Ù„Ø© console.logs ØªÙ…Ø§Ù…Ø§Ù‹ (Ù„Ù„Ø¥Ù†ØªØ§Ø¬)
// Ù‚Ø¨Ù„:
console.log('ğŸ“… Creating scheduled payments...');

// Ø¨Ø¹Ø¯:
// Ø­Ø°Ù Ø§Ù„Ø³Ø·Ø±

// Ø®ÙŠØ§Ø± 2: Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¨Ù€ devLogger (Ù„Ù„ØªØ·ÙˆÙŠØ±)
import { devLog, devError } from '../utils/devLogger';

// Ù‚Ø¨Ù„:
console.log('Data:', data);
console.error('Error:', error);

// Ø¨Ø¹Ø¯:
devLog('Data:', data);
devError('Error:', error);
```

**Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:**
- âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ console.log/error/warn ÙÙŠ production build
- âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… devLogger ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± ÙÙ‚Ø·

---

### âœ… Task 1.3: Ø­Ø°Ù Dead Code
**Ø§Ù„Ù…Ù„ÙØ§Øª:**
1. `components/pages/sales/Bookings.tsx` - Ø­Ø°Ù old payments modal Ø§Ù„Ù…Ø¹Ø·Ù‘Ù„
2. `components/pages/sales/ScheduledPayments.tsx` - Ù‚Ø±Ø§Ø±: Ø­Ø°Ù Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…ØŸ

**Ø§Ù„Ø®Ø·ÙˆØ§Øª:**
```typescript
// ÙÙŠ Bookings.tsx - Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„:
{false && showPaymentsModal && selectedBookingForPayments && (
    <div className="fixed inset-0...">
        {/* Old Payment Modal - 200+ Ø³Ø·Ø± */}
    </div>
)}

// Ù‚Ø±Ø§Ø± ScheduledPayments.tsx:
// Ø®ÙŠØ§Ø± 1: Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø¥Ø°Ø§ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…
// Ø®ÙŠØ§Ø± 2: ØªØ·ÙˆÙŠØ±Ù‡ ÙƒÙ„ÙˆØ­Ø© ØªØ­ÙƒÙ… (Ø§Ù†Ø¸Ø± Phase 2)
```

**Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:**
- âœ… ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… bundle size
- âœ… ÙƒÙˆØ¯ Ø£Ù†Ø¸Ù ÙˆØ£Ø³Ù‡Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©

---

<a name="phase-2"></a>
## ğŸ¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:** 1-2 Ø£Ø³Ø§Ø¨ÙŠØ¹  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** Ø¹Ø§Ù„ÙŠØ© ğŸ”´

---

### ğŸ“Š Task 2.1: Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„
**Ø§Ù„Ø­Ø§Ù„Ø©:** Ø¬Ø¯ÙŠØ¯ ğŸ†•  
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±:** 4-5 Ø£ÙŠØ§Ù…

#### Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
```
components/pages/accounting/
â”œâ”€â”€ FinancialReports.tsx          (ØµÙØ­Ø© Ø±Ø¦ÙŠØ³ÙŠØ©)
â”œâ”€â”€ Reports/
â”‚   â”œâ”€â”€ IncomeStatement.tsx       (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„)
â”‚   â”œâ”€â”€ CashFlowReport.tsx        (Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©)
â”‚   â”œâ”€â”€ BudgetComparison.tsx      (Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© vs Ø§Ù„ÙØ¹Ù„ÙŠ)
â”‚   â”œâ”€â”€ ProjectReport.tsx         (ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹)
â”‚   â””â”€â”€ CustomReport.tsx          (ØªÙ‚Ø±ÙŠØ± Ù…Ø®ØµØµ)
utils/
â”œâ”€â”€ reportGenerator.ts            (Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±)
â””â”€â”€ exportHelpers.ts              (ØªØµØ¯ÙŠØ± PDF/Excel)
```

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©:

**Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©**
```typescript
// components/pages/accounting/FinancialReports.tsx
interface ReportFilters {
  startDate: string;
  endDate: string;
  projectId?: string;
  reportType: 'income' | 'cashflow' | 'budget' | 'project' | 'custom';
}

export const FinancialReports: React.FC = () => {
  const [filters, setFilters] = useState<ReportFilters>({...});
  const [reportData, setReportData] = useState<any>(null);
  const [loading, setLoading] = useState(false);

  // Generate report based on filters
  const generateReport = async () => {
    setLoading(true);
    const data = await reportGenerator.generate(filters);
    setReportData(data);
    setLoading(false);
  };

  return (
    <div>
      {/* Filters Section */}
      <ReportFilters filters={filters} onChange={setFilters} />
      
      {/* Report Tabs */}
      <Tabs>
        <Tab label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„"><IncomeStatement data={reportData} /></Tab>
        <Tab label="Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©"><CashFlowReport data={reportData} /></Tab>
        <Tab label="Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©"><BudgetComparison data={reportData} /></Tab>
        <Tab label="Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹"><ProjectReport data={reportData} /></Tab>
      </Tabs>

      {/* Export Buttons */}
      <div className="flex gap-2">
        <button onClick={() => exportHelpers.toPDF(reportData)}>
          ØªØµØ¯ÙŠØ± PDF
        </button>
        <button onClick={() => exportHelpers.toExcel(reportData)}>
          ØªØµØ¯ÙŠØ± Excel
        </button>
      </div>
    </div>
  );
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªÙ‚Ø±ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ (Income Statement)**
```typescript
// components/pages/accounting/Reports/IncomeStatement.tsx
interface IncomeStatementData {
  revenue: {
    unitSales: number;
    bookingPayments: number;
    installments: number;
    total: number;
  };
  expenses: {
    operational: number;
    salaries: number;
    marketing: number;
    other: number;
    total: number;
  };
  netIncome: number;
  profitMargin: number;
}

const IncomeStatement: React.FC<{ data: IncomeStatementData }> = ({ data }) => {
  return (
    <div className="report-container">
      <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ - Income Statement</h2>
      <p className="period">{data.period}</p>

      {/* Revenue Section */}
      <section className="revenue">
        <h3>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - Revenue</h3>
        <table>
          <tr><td>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª</td><td>{formatCurrency(data.revenue.unitSales)}</td></tr>
          <tr><td>Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø­Ø¬Ø²</td><td>{formatCurrency(data.revenue.bookingPayments)}</td></tr>
          <tr><td>Ø£Ù‚Ø³Ø§Ø·</td><td>{formatCurrency(data.revenue.installments)}</td></tr>
          <tr className="total"><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</td><td>{formatCurrency(data.revenue.total)}</td></tr>
        </table>
      </section>

      {/* Expenses Section */}
      <section className="expenses">
        <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª - Expenses</h3>
        <table>
          <tr><td>ØªØ´ØºÙŠÙ„ÙŠØ©</td><td>{formatCurrency(data.expenses.operational)}</td></tr>
          <tr><td>Ø±ÙˆØ§ØªØ¨</td><td>{formatCurrency(data.expenses.salaries)}</td></tr>
          <tr><td>ØªØ³ÙˆÙŠÙ‚</td><td>{formatCurrency(data.expenses.marketing)}</td></tr>
          <tr><td>Ø£Ø®Ø±Ù‰</td><td>{formatCurrency(data.expenses.other)}</td></tr>
          <tr className="total"><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</td><td>{formatCurrency(data.expenses.total)}</td></tr>
        </table>
      </section>

      {/* Net Income */}
      <section className="net-income">
        <h3>ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„ - Net Income</h3>
        <div className="big-number">
          {formatCurrency(data.netIncome)}
        </div>
        <p>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­: {data.profitMargin.toFixed(2)}%</p>
      </section>

      {/* Chart */}
      <BarChart 
        data={[
          { name: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', value: data.revenue.total },
          { name: 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', value: data.expenses.total },
          { name: 'ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„', value: data.netIncome }
        ]}
      />
    </div>
  );
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©**
```typescript
// components/pages/accounting/Reports/CashFlowReport.tsx
interface CashFlowData {
  operatingActivities: {
    cashFromSales: number;
    cashFromPayments: number;
    cashPaid: number;
    netOperating: number;
  };
  investingActivities: {
    purchaseAssets: number;
    saleAssets: number;
    netInvesting: number;
  };
  financingActivities: {
    loans: number;
    repayments: number;
    netFinancing: number;
  };
  netCashFlow: number;
  openingBalance: number;
  closingBalance: number;
}

const CashFlowReport: React.FC<{ data: CashFlowData }> = ({ data }) => {
  return (
    <div className="cash-flow-report">
      <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©</h2>

      {/* Operating Activities */}
      <section>
        <h3>Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</h3>
        <table>
          <tr><td>Ù†Ù‚Ø¯ Ù…Ù† Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td><td className="positive">{formatCurrency(data.operatingActivities.cashFromSales)}</td></tr>
          <tr><td>Ù†Ù‚Ø¯ Ù…Ù† Ø§Ù„Ø¯ÙØ¹Ø§Øª</td><td className="positive">{formatCurrency(data.operatingActivities.cashFromPayments)}</td></tr>
          <tr><td>Ù†Ù‚Ø¯ Ù…Ø¯ÙÙˆØ¹</td><td className="negative">({formatCurrency(data.operatingActivities.cashPaid)})</td></tr>
          <tr className="subtotal"><td>ØµØ§ÙÙŠ Ø§Ù„Ù†Ù‚Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ</td><td>{formatCurrency(data.operatingActivities.netOperating)}</td></tr>
        </table>
      </section>

      {/* Summary */}
      <section className="summary">
        <div className="balance-row">
          <span>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ</span>
          <span>{formatCurrency(data.openingBalance)}</span>
        </div>
        <div className="balance-row">
          <span>ØµØ§ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ</span>
          <span className={data.netCashFlow >= 0 ? 'positive' : 'negative'}>
            {formatCurrency(data.netCashFlow)}
          </span>
        </div>
        <div className="balance-row total">
          <span>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø®ØªØ§Ù…ÙŠ</span>
          <span>{formatCurrency(data.closingBalance)}</span>
        </div>
      </section>

      {/* Chart */}
      <LineChart 
        data={data.monthlyTrend}
        xKey="month"
        yKey="cashFlow"
        title="Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ"
      />
    </div>
  );
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Report Generator)**
```typescript
// utils/reportGenerator.ts
export const reportGenerator = {
  async generate(filters: ReportFilters) {
    const { startDate, endDate, projectId, reportType } = filters;

    // Fetch data from Supabase
    const [bookings, payments, expenses, units] = await Promise.all([
      bookingsService.getByDateRange(startDate, endDate, projectId),
      paymentsService.getByDateRange(startDate, endDate, projectId),
      expensesService.getByDateRange(startDate, endDate, projectId),
      unitsService.getAll()
    ]);

    // Calculate revenue
    const revenue = {
      unitSales: this.calculateUnitSales(units, bookings),
      bookingPayments: this.calculateBookingPayments(payments),
      installments: this.calculateInstallments(payments),
      total: 0
    };
    revenue.total = revenue.unitSales + revenue.bookingPayments + revenue.installments;

    // Calculate expenses
    const expensesData = {
      operational: this.sumByCategory(expenses, 'operational'),
      salaries: this.sumByCategory(expenses, 'salaries'),
      marketing: this.sumByCategory(expenses, 'marketing'),
      other: this.sumByCategory(expenses, 'other'),
      total: 0
    };
    expensesData.total = Object.values(expensesData).reduce((sum, val) => sum + val, 0) - expensesData.total;

    // Net income
    const netIncome = revenue.total - expensesData.total;
    const profitMargin = (netIncome / revenue.total) * 100;

    return {
      period: `${startDate} - ${endDate}`,
      revenue,
      expenses: expensesData,
      netIncome,
      profitMargin
    };
  },

  calculateUnitSales(units: Unit[], bookings: Booking[]): number {
    return bookings.reduce((sum, booking) => {
      const unit = units.find(u => u.id === booking.unitId);
      return sum + (unit?.price || 0);
    }, 0);
  },

  calculateBookingPayments(payments: Payment[]): number {
    return payments
      .filter(p => p.paymentType === 'booking')
      .reduce((sum, p) => sum + p.amount, 0);
  },

  calculateInstallments(payments: Payment[]): number {
    return payments
      .filter(p => p.paymentType === 'installment')
      .reduce((sum, p) => sum + p.amount, 0);
  },

  sumByCategory(expenses: Expense[], category: string): number {
    return expenses
      .filter(e => e.category === category)
      .reduce((sum, e) => sum + e.amount, 0);
  }
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø§Ù„ØªØµØ¯ÙŠØ± (Export Helpers)**
```typescript
// utils/exportHelpers.ts
import jsPDF from 'jspdf';
import * as XLSX from 'xlsx';

export const exportHelpers = {
  toPDF(reportData: any) {
    const doc = new jsPDF();
    
    // Header
    doc.setFontSize(18);
    doc.text('ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ', 105, 20, { align: 'center' });
    doc.setFontSize(12);
    doc.text(`Ø§Ù„ÙØªØ±Ø©: ${reportData.period}`, 105, 30, { align: 'center' });

    // Revenue Section
    let yPos = 50;
    doc.setFontSize(14);
    doc.text('Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', 20, yPos);
    yPos += 10;
    doc.setFontSize(10);
    doc.text(`Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª: ${formatCurrency(reportData.revenue.unitSales)}`, 30, yPos);
    yPos += 7;
    doc.text(`Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø­Ø¬Ø²: ${formatCurrency(reportData.revenue.bookingPayments)}`, 30, yPos);
    yPos += 7;
    doc.text(`Ø£Ù‚Ø³Ø§Ø·: ${formatCurrency(reportData.revenue.installments)}`, 30, yPos);
    yPos += 10;
    doc.setFontSize(12);
    doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: ${formatCurrency(reportData.revenue.total)}`, 30, yPos);

    // Expenses Section
    yPos += 20;
    doc.setFontSize(14);
    doc.text('Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', 20, yPos);
    yPos += 10;
    doc.setFontSize(10);
    doc.text(`ØªØ´ØºÙŠÙ„ÙŠØ©: ${formatCurrency(reportData.expenses.operational)}`, 30, yPos);
    yPos += 7;
    doc.text(`Ø±ÙˆØ§ØªØ¨: ${formatCurrency(reportData.expenses.salaries)}`, 30, yPos);
    yPos += 10;
    doc.setFontSize(12);
    doc.text(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${formatCurrency(reportData.expenses.total)}`, 30, yPos);

    // Net Income
    yPos += 20;
    doc.setFontSize(16);
    doc.text(`ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„: ${formatCurrency(reportData.netIncome)}`, 20, yPos);

    doc.save(`financial-report-${new Date().toISOString().split('T')[0]}.pdf`);
  },

  toExcel(reportData: any) {
    const wb = XLSX.utils.book_new();

    // Revenue sheet
    const revenueData = [
      ['Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', 'Ø§Ù„Ù…Ø¨Ù„Øº'],
      ['Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª', reportData.revenue.unitSales],
      ['Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø­Ø¬Ø²', reportData.revenue.bookingPayments],
      ['Ø£Ù‚Ø³Ø§Ø·', reportData.revenue.installments],
      ['', ''],
      ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', reportData.revenue.total]
    ];
    const wsRevenue = XLSX.utils.aoa_to_sheet(revenueData);
    XLSX.utils.book_append_sheet(wb, wsRevenue, 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª');

    // Expenses sheet
    const expensesData = [
      ['Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', 'Ø§Ù„Ù…Ø¨Ù„Øº'],
      ['ØªØ´ØºÙŠÙ„ÙŠØ©', reportData.expenses.operational],
      ['Ø±ÙˆØ§ØªØ¨', reportData.expenses.salaries],
      ['ØªØ³ÙˆÙŠÙ‚', reportData.expenses.marketing],
      ['Ø£Ø®Ø±Ù‰', reportData.expenses.other],
      ['', ''],
      ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', reportData.expenses.total]
    ];
    const wsExpenses = XLSX.utils.aoa_to_sheet(expensesData);
    XLSX.utils.book_append_sheet(wb, wsExpenses, 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª');

    // Summary sheet
    const summaryData = [
      ['Ø§Ù„Ø¨Ù†Ø¯', 'Ø§Ù„Ù…Ø¨Ù„Øº'],
      ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', reportData.revenue.total],
      ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', reportData.expenses.total],
      ['', ''],
      ['ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„', reportData.netIncome],
      ['Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ %', reportData.profitMargin.toFixed(2)]
    ];
    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
    XLSX.utils.book_append_sheet(wb, wsSummary, 'Ø§Ù„Ù…Ù„Ø®Øµ');

    XLSX.writeFile(wb, `financial-report-${new Date().toISOString().split('T')[0]}.xlsx`);
  }
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 6: Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Sidebar**
```typescript
// components/Sidebar.tsx
{interfaceMode === 'expenses' && (
  <NavLink to="/accounting/financial-reports" icon={<DocumentTextIcon />}>
    Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©
  </NavLink>
)}
```

**Ø§Ù„Ø®Ø·ÙˆØ© 7: Ø¥Ø¶Ø§ÙØ© Route ÙÙŠ App**
```typescript
// App.tsx
<Route path="/accounting/financial-reports" element={<FinancialReports />} />
```

**Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª (Dependencies):**
```json
{
  "dependencies": {
    "jspdf": "^2.5.1",
    "xlsx": "^0.18.5",
    "recharts": "^2.10.0"
  }
}
```

**Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:**
- âœ… Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
- âœ… Ø¹Ø±Ø¶ Ø§Ù„ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ÙŠØ©
- âœ… Ø¹Ø±Ø¶ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©
- âœ… ØªØµØ¯ÙŠØ± PDF ÙŠØ¹Ù…Ù„
- âœ… ØªØµØ¯ÙŠØ± Excel ÙŠØ¹Ù…Ù„
- âœ… Charts ØªØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­

---

### ğŸ”” Task 2.2: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
**Ø§Ù„Ø­Ø§Ù„Ø©:** Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ø§Ù„Ù†Ø¸Ø§Ù… ØºÙŠØ± Ù†Ø´Ø·  
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±:** 3-4 Ø£ÙŠØ§Ù…

#### Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
```
components/
â”œâ”€â”€ Header.tsx                    (ØªØ¹Ø¯ÙŠÙ„ - Ø¥Ø¶Ø§ÙØ© notification bell)
â”œâ”€â”€ NotificationPanel.tsx         (Ø¬Ø¯ÙŠØ¯)
supabase/functions/
â”œâ”€â”€ check-overdue-payments/
â”‚   â””â”€â”€ index.ts                  (Edge Function)
services/
â””â”€â”€ notificationService.ts        (Ø¬Ø¯ÙŠØ¯)
```

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

**Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ù†Ø´Ø§Ø¡ Supabase Edge Function**
```typescript
// supabase/functions/check-overdue-payments/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

serve(async (req) => {
  try {
    const supabaseUrl = Deno.env.get('SUPABASE_URL')!;
    const supabaseKey = Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!;
    const supabase = createClient(supabaseUrl, supabaseKey);

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const { data, error } = await supabase.rpc('check_overdue_payments_and_notify');

    if (error) throw error;

    return new Response(
      JSON.stringify({ 
        success: true, 
        notificationsCreated: data,
        timestamp: new Date().toISOString()
      }),
      { headers: { 'Content-Type': 'application/json' } }
    );
  } catch (error) {
    return new Response(
      JSON.stringify({ success: false, error: error.message }),
      { status: 500, headers: { 'Content-Type': 'application/json' } }
    );
  }
});
```

**Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¬Ø¯ÙˆÙ„Ø© Cron Job**
```toml
# supabase/config.toml
[functions.check-overdue-payments]
verify_jwt = false

[functions.check-overdue-payments.cron]
# ØªØ´ØºÙŠÙ„ ÙŠÙˆÙ…ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© 8 ØµØ¨Ø§Ø­Ø§Ù‹
schedule = "0 8 * * *"
```

**Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ø¶Ø§ÙØ© notification bell ÙÙŠ Header**
```typescript
// components/Header.tsx - ØªØ¹Ø¯ÙŠÙ„
import { BellIcon } from './shared/Icons';
import NotificationPanel from './NotificationPanel';

export const Header: React.FC = () => {
  const [showNotifications, setShowNotifications] = useState(false);
  const [unreadCount, setUnreadCount] = useState(0);

  useEffect(() => {
    loadUnreadCount();
    
    // Subscribe to new notifications
    const subscription = paymentNotificationsService.subscribe((notifications) => {
      const unread = notifications.filter(n => !n.isRead).length;
      setUnreadCount(unread);
    });

    return () => subscription?.unsubscribe();
  }, []);

  const loadUnreadCount = async () => {
    const notifications = await paymentNotificationsService.getUnread();
    setUnreadCount(notifications.length);
  };

  return (
    <header>
      {/* ... existing header content ... */}
      
      <button 
        onClick={() => setShowNotifications(!showNotifications)}
        className="notification-bell relative"
      >
        <BellIcon className="w-6 h-6" />
        {unreadCount > 0 && (
          <span className="badge">{unreadCount}</span>
        )}
      </button>

      {showNotifications && (
        <NotificationPanel onClose={() => setShowNotifications(false)} />
      )}
    </header>
  );
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª**
```typescript
// components/NotificationPanel.tsx
interface Props {
  onClose: () => void;
}

export const NotificationPanel: React.FC<Props> = ({ onClose }) => {
  const [notifications, setNotifications] = useState<PaymentNotification[]>([]);
  const [filter, setFilter] = useState<'all' | 'unread'>('unread');

  useEffect(() => {
    loadNotifications();
  }, [filter]);

  const loadNotifications = async () => {
    const data = filter === 'unread' 
      ? await paymentNotificationsService.getUnread()
      : await paymentNotificationsService.getAll();
    setNotifications(data);
  };

  const handleMarkAsRead = async (id: string) => {
    await paymentNotificationsService.markAsRead(id);
    loadNotifications();
  };

  const handleMarkAllAsRead = async () => {
    await paymentNotificationsService.markAllAsRead();
    loadNotifications();
  };

  return (
    <div className="notification-panel">
      <div className="header">
        <h3>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
        <button onClick={onClose}><CloseIcon /></button>
      </div>

      <div className="filters">
        <button 
          className={filter === 'all' ? 'active' : ''}
          onClick={() => setFilter('all')}
        >
          Ø§Ù„ÙƒÙ„
        </button>
        <button 
          className={filter === 'unread' ? 'active' : ''}
          onClick={() => setFilter('unread')}
        >
          ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
        </button>
        <button onClick={handleMarkAllAsRead}>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡</button>
      </div>

      <div className="notifications-list">
        {notifications.map(notification => (
          <div 
            key={notification.id}
            className={`notification-item ${!notification.isRead ? 'unread' : ''}`}
            onClick={() => handleMarkAsRead(notification.id)}
          >
            <div className="icon">
              {notification.notificationType === 'overdue' && <ExclamationIcon className="text-red-500" />}
              {notification.notificationType === 'due_today' && <ClockIcon className="text-amber-500" />}
              {notification.notificationType === 'reminder' && <CalendarIcon className="text-blue-500" />}
            </div>
            <div className="content">
              <h4>{notification.customerName}</h4>
              <p>Ø¯ÙØ¹Ø© Ù…Ø³ØªØ­Ù‚Ø© Ø¨Ù‚ÙŠÙ…Ø© {formatCurrency(notification.amountDue)}</p>
              <p className="unit">Ø§Ù„ÙˆØ­Ø¯Ø©: {notification.unitName}</p>
              <p className="date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {notification.dueDate}</p>
            </div>
            {!notification.isRead && <div className="unread-dot" />}
          </div>
        ))}

        {notifications.length === 0 && (
          <div className="empty">
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
          </div>
        )}
      </div>
    </div>
  );
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„)**
```typescript
// src/services/supabaseService.ts - paymentNotificationsService
// Ø§Ù„Ø®Ø¯Ù…Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ÙÙ‚Ø· Ù†Ø­ØªØ§Ø¬ subscribe:

export const paymentNotificationsService = {
  // ... existing methods ...

  subscribe(callback: (notifications: PaymentNotification[]) => void) {
    const channel = supabase
      .channel('payment_notifications_changes')
      .on('postgres_changes', 
        { event: '*', schema: 'public', table: 'payment_notifications' },
        () => {
          this.getAll().then(callback);
        }
      )
      .subscribe();

    // Initial load
    this.getAll().then(callback);

    return {
      unsubscribe: () => supabase.removeChannel(channel)
    };
  }
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 6: Ù†Ø´Ø± Edge Function**
```bash
# Terminal
supabase functions deploy check-overdue-payments
```

**Ø§Ù„Ø®Ø·ÙˆØ© 7: Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ**
```bash
# Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
curl -X POST https://your-project.supabase.co/functions/v1/check-overdue-payments \
  -H "Authorization: Bearer YOUR_ANON_KEY"
```

**Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:**
- âœ… Cron job ÙŠØ¹Ù…Ù„ ÙŠÙˆÙ…ÙŠØ§Ù‹
- âœ… Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙÙ†Ø´Ø£ Ù„Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©/Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©
- âœ… notification bell ØªØ¸Ù‡Ø± Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØµØ­ÙŠØ­
- âœ… Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¹Ù…Ù„
- âœ… ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡ ÙŠØ¹Ù…Ù„

---

### ğŸ—„ï¸ Task 2.3: ØªØ­Ø³ÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø±Ø´ÙØ©
**Ø§Ù„Ø­Ø§Ù„Ø©:** Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ø¨Ø³ÙŠØ·  
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±:** 2-3 Ø£ÙŠØ§Ù…

#### Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„ØªØ¹Ø¯ÙŠÙ„/Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:
```
components/pages/sales/
â”œâ”€â”€ GeneralArchive.tsx            (ØªØ·ÙˆÙŠØ± ÙƒØ¨ÙŠØ±)
â”œâ”€â”€ BookingArchive.tsx            (Ø¬Ø¯ÙŠØ¯ - Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
utils/
â””â”€â”€ archiveHelper.ts              (ØªØ­Ø³ÙŠÙ†)
```

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

**Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ø³ÙŠÙ† archiveHelper**
```typescript
// utils/archiveHelper.ts - ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø¶Ø§ÙØ©
export const archiveHelper = {
  // ... existing methods ...

  async archiveWithReason(
    itemType: string,
    itemId: string,
    itemData: any,
    archivedBy: string,
    reason: string // Ø¬Ø¯ÙŠØ¯
  ) {
    const archiveId = generateUniqueId('archive');
    const { error } = await supabase
      .from('general_archive')
      .insert([{
        id: archiveId,
        item_type: itemType,
        item_id: itemId,
        item_data: itemData,
        archived_by: archivedBy,
        archive_reason: reason, // Ø¬Ø¯ÙŠØ¯
        archived_at: new Date().toISOString()
      }]);

    if (error) throw error;
    return archiveId;
  },

  async restoreWithValidation(archiveId: string): Promise<{success: boolean, error?: string}> {
    const { data: archivedItem, error: fetchError } = await supabase
      .from('general_archive')
      .select('*')
      .eq('id', archiveId)
      .single();

    if (fetchError || !archivedItem) {
      return { success: false, error: 'Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ø¤Ø±Ø´Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
    }

    // Validation before restore
    const itemType = archivedItem.item_type;
    const itemData = archivedItem.item_data;

    // Check if item can be restored (e.g., customer with same name doesn't exist)
    if (itemType === 'customers') {
      const { data: existingCustomer } = await supabase
        .from('customers')
        .select('id')
        .eq('name', itemData.name)
        .single();

      if (existingCustomer) {
        return { success: false, error: 'ÙŠÙˆØ¬Ø¯ Ø¹Ù…ÙŠÙ„ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙØ¹Ù„' };
      }
    }

    // Restore...
    // ... existing restore logic ...

    return { success: true };
  }
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ·ÙˆÙŠØ± ÙˆØ§Ø¬Ù‡Ø© GeneralArchive**
```typescript
// components/pages/sales/GeneralArchive.tsx - ØªØ·ÙˆÙŠØ± ÙƒØ¨ÙŠØ±
export const GeneralArchive: React.FC = () => {
  const [archivedItems, setArchivedItems] = useState<ArchivedItem[]>([]);
  const [filter, setFilter] = useState<string>('all');
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedItem, setSelectedItem] = useState<ArchivedItem | null>(null);
  const [showRestoreModal, setShowRestoreModal] = useState(false);

  const filteredItems = useMemo(() => {
    let items = archivedItems;

    // Filter by type
    if (filter !== 'all') {
      items = items.filter(item => item.item_type === filter);
    }

    // Filter by search term
    if (searchTerm) {
      items = items.filter(item => {
        const data = item.item_data;
        return JSON.stringify(data).toLowerCase().includes(searchTerm.toLowerCase());
      });
    }

    return items.sort((a, b) => 
      new Date(b.archived_at).getTime() - new Date(a.archived_at).getTime()
    );
  }, [archivedItems, filter, searchTerm]);

  const handleRestore = async (item: ArchivedItem) => {
    setSelectedItem(item);
    setShowRestoreModal(true);
  };

  const confirmRestore = async () => {
    if (!selectedItem) return;

    try {
      const result = await archiveHelper.restoreWithValidation(selectedItem.id);
      
      if (result.success) {
        addToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadData();
      } else {
        addToast(result.error || 'ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©', 'error');
      }
    } catch (error) {
      addToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©', 'error');
    } finally {
      setShowRestoreModal(false);
      setSelectedItem(null);
    }
  };

  return (
    <div className="archive-page">
      <header>
        <h1>Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø¹Ø§Ù…</h1>
        <div className="filters">
          <select value={filter} onChange={(e) => setFilter(e.target.value)}>
            <option value="all">Ø§Ù„ÙƒÙ„</option>
            <option value="bookings">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</option>
            <option value="customers">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
            <option value="units">Ø§Ù„ÙˆØ­Ø¯Ø§Øª</option>
            <option value="payments">Ø§Ù„Ø¯ÙØ¹Ø§Øª</option>
          </select>
          <input
            type="search"
            placeholder="Ø¨Ø­Ø«..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </div>
      </header>

      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø´ÙØ©</th>
            <th>Ø¨ÙˆØ§Ø³Ø·Ø©</th>
            <th>Ø§Ù„Ø³Ø¨Ø¨</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {filteredItems.map(item => (
            <tr key={item.id}>
              <td>
                <span className={`badge ${item.item_type}`}>
                  {getTypeLabel(item.item_type)}
                </span>
              </td>
              <td>
                <ItemDataPreview data={item.item_data} type={item.item_type} />
              </td>
              <td>{new Date(item.archived_at).toLocaleDateString('ar')}</td>
              <td>{item.archived_by}</td>
              <td>{item.archive_reason || '-'}</td>
              <td>
                <button onClick={() => handleRestore(item)} className="btn-restore">
                  Ø§Ø³ØªØ¹Ø§Ø¯Ø©
                </button>
                <button onClick={() => handleDelete(item.id)} className="btn-delete">
                  Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {showRestoreModal && selectedItem && (
        <ConfirmModal
          isOpen={true}
          title="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©"
          message={`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© ${getTypeLabel(selectedItem.item_type)}ØŸ`}
          onConfirm={confirmRestore}
          onCancel={() => setShowRestoreModal(false)}
        />
      )}
    </div>
  );
};

// Helper components
const ItemDataPreview: React.FC<{ data: any, type: string }> = ({ data, type }) => {
  switch (type) {
    case 'customers':
      return <div><strong>{data.name}</strong> - {data.phone}</div>;
    case 'bookings':
      return <div>Ø§Ù„ÙˆØ­Ø¯Ø©: {data.unitName} - Ø§Ù„Ø¹Ù…ÙŠÙ„: {data.customerName}</div>;
    case 'units':
      return <div>{data.name} - {formatCurrency(data.price)}</div>;
    default:
      return <div>{JSON.stringify(data).slice(0, 50)}...</div>;
  }
};
```

**Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­:**
- âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø¨ØªØµÙÙŠØ© ÙˆØ¨Ø­Ø«
- âœ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø¹ validation
- âœ… Ø³Ø¨Ø¨ Ø§Ù„Ø£Ø±Ø´ÙØ© ÙŠÙØ³Ø¬Ù‘Ù„
- âœ… Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ù…ÙÙ‡ÙˆÙ…

---

### ğŸ“„ Task 2.4: ØªØ­Ø³ÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù‚Ø¯Ø±:** 2 Ø£ÙŠØ§Ù…

#### Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:
1. ÙØ¦Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
2. ØªÙˆØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡
3. ØªÙ†Ø²ÙŠÙ„ Ù…Ø¬Ù…Ù‘Ø¹
4. Ù…Ø¹Ø§ÙŠÙ†Ø© PDF Ù…Ø¯Ù…Ø¬Ø©

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

**Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ¹Ø¯ÙŠÙ„ types.ts**
```typescript
// types.ts - ØªØ¹Ø¯ÙŠÙ„ Document interface
export interface Document {
  id: string;
  name: string;
  type: string;
  size: number;
  url: string;
  uploaded_at: string;
  uploaded_by?: string;
  // Ø¬Ø¯ÙŠØ¯:
  category?: 'contract' | 'id' | 'deed' | 'invoice' | 'receipt' | 'other';
  expiry_date?: string;
  notes?: string;
  tags?: string[];
}
```

**Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ¹Ø¯ÙŠÙ„ migration Ù„Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª**
```sql
-- Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ù…Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¬Ø¯ÙˆÙ„ documents (Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©)
ALTER TABLE documents ADD COLUMN IF NOT EXISTS category TEXT;
ALTER TABLE documents ADD COLUMN IF NOT EXISTS expiry_date DATE;
ALTER TABLE documents ADD COLUMN IF NOT EXISTS notes TEXT;
ALTER TABLE documents ADD COLUMN IF NOT EXISTS tags TEXT[];
```

**Ø§Ù„Ø®Ø·ÙˆØ© 3: ØªØ­Ø³ÙŠÙ† DocumentManager**
```typescript
// components/shared/DocumentManager.tsx - Ø¥Ø¶Ø§ÙØ§Øª
const DocumentManager: React.FC<Props> = ({ entityType, entityId }) => {
  // ... existing state ...
  const [selectedCategory, setSelectedCategory] = useState<string>('all');

  const filteredDocs = useMemo(() => {
    if (selectedCategory === 'all') return documents;
    return documents.filter(doc => doc.category === selectedCategory);
  }, [documents, selectedCategory]);

  const handleBulkDownload = async () => {
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… JSZip Ù„Ø¥Ù†Ø´Ø§Ø¡ ZIP
    const JSZip = (await import('jszip')).default;
    const zip = new JSZip();

    for (const doc of filteredDocs) {
      const response = await fetch(doc.url);
      const blob = await response.blob();
      zip.file(doc.name, blob);
    }

    const content = await zip.generateAsync({ type: 'blob' });
    const url = URL.createObjectURL(content);
    const a = document.createElement('a');
    a.href = url;
    a.download = `documents-${entityId}.zip`;
    a.click();
  };

  return (
    <div className="document-manager">
      <div className="toolbar">
        <select value={selectedCategory} onChange={(e) => setSelectedCategory(e.target.value)}>
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
          <option value="contract">Ø¹Ù‚ÙˆØ¯</option>
          <option value="id">Ù‡ÙˆÙŠØ§Øª</option>
          <option value="deed">Ø³Ù†Ø¯Ø§Øª</option>
          <option value="invoice">ÙÙˆØ§ØªÙŠØ±</option>
          <option value="receipt">Ø¥ÙŠØµØ§Ù„Ø§Øª</option>
          <option value="other">Ø£Ø®Ø±Ù‰</option>
        </select>
        <button onClick={handleBulkDownload}>ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙƒÙ„ (ZIP)</button>
      </div>

      <div className="documents-grid">
        {filteredDocs.map(doc => (
          <DocumentCard 
            key={doc.id} 
            doc={doc}
            onView={() => handleViewDoc(doc)}
            onDelete={() => handleDelete(doc.id)}
          />
        ))}
      </div>
    </div>
  );
};

const DocumentCard: React.FC<{doc: Document}> = ({ doc, onView, onDelete }) => {
  const isExpired = doc.expiry_date && new Date(doc.expiry_date) < new Date();

  return (
    <div className={`document-card ${isExpired ? 'expired' : ''}`}>
      <div className="category-badge">{getCategoryLabel(doc.category)}</div>
      <FileIcon type={doc.type} />
      <h4>{doc.name}</h4>
      {doc.expiry_date && (
        <p className="expiry">
          {isExpired ? 'âš ï¸ Ù…Ù†ØªÙ‡ÙŠ' : 'ÙŠÙ†ØªÙ‡ÙŠ'}: {doc.expiry_date}
        </p>
      )}
      {doc.notes && <p className="notes">{doc.notes}</p>}
      <div className="actions">
        <button onClick={onView}>Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
        <button onClick={onDelete}>Ø­Ø°Ù</button>
      </div>
    </div>
  );
};
```

**Ø§Ù„Ø®Ø·ÙˆØ© 4: Ù…Ø¹Ø§ÙŠÙ†Ø© PDF Ù…Ø¯Ù…Ø¬Ø©**
```typescript
// components/shared/PDFViewer.tsx - Ø¬Ø¯ÙŠØ¯
import { Document, Page, pdfjs } from 'react-pdf';

pdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`;

export const PDFViewer: React.FC<{ url: string }> = ({ url }) => {
  const [numPages, setNumPages] = useState<number>(0);
  const [pageNumber, setPageNumber] = useState<number>(1);

  return (
    <div className="pdf-viewer">
      <div className="controls">
        <button 
          disabled={pageNumber <= 1}
          onClick={() => setPageNumber(pageNumber - 1)}
        >
          Ø§Ù„Ø³Ø§Ø¨Ù‚
        </button>
        <span>ØµÙØ­Ø© {pageNumber} Ù…Ù† {numPages}</span>
        <button 
          disabled={pageNumber >= numPages}
          onClick={() => setPageNumber(pageNumber + 1)}
        >
          Ø§Ù„ØªØ§Ù„ÙŠ
        </button>
      </div>

      <Document
        file={url}
        onLoadSuccess={({ numPages }) => setNumPages(numPages)}
      >
        <Page pageNumber={pageNumber} />
      </Document>
    </div>
  );
};
```

**Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:**
```json
{
  "dependencies": {
    "jszip": "^3.10.1",
    "react-pdf": "^7.7.0"
  }
}
```

---

<a name="phase-3"></a>
## ğŸŒŸ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:** 2-3 Ø£Ø³Ø§Ø¨ÙŠØ¹  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** Ù…ØªÙˆØ³Ø·Ø© ğŸŸ¡

### Task 3.1: Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
### Task 3.2: Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
### Task 3.3: SMS/Email Notifications
### Task 3.4: Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Scheduled Payments

(ØªÙØ§ØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ)

---

<a name="phase-4"></a>
## ğŸ“ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©
**Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©:** 1-2 Ø£Ø³Ø§Ø¨ÙŠØ¹  
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:** Ù…Ù†Ø®ÙØ¶Ø© Ù„ÙƒÙ† Ù…Ù‡Ù…Ø© ğŸŸ¢

### Task 4.1: Unit Tests
### Task 4.2: E2E Tests
### Task 4.3: Performance Optimization
### Task 4.4: Mobile Responsiveness

---

<a name="details"></a>
## ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©

(ÙŠØªÙ… Ø§Ø³ØªÙƒÙ…Ø§Ù„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)

---

## ğŸ“Š Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„ØªÙ‚Ø¯Ù…

### Progress Tracker
```
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: [========  ] 80% (2/3 tasks)
  âœ… Task 1.1: ØªØ·Ø¨ÙŠÙ‚ RLS (ÙŠØ­ØªØ§Ø¬ ØªÙ†ÙÙŠØ° ÙÙŠ Supabase)
  âœ… Task 1.2: ØªÙ†Ø¸ÙŠÙ Console Logs (Ù…ÙƒØªÙ…Ù„ 90%)
  â³ Task 1.3: Ø­Ø°Ù Dead Code (Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°)
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: [          ] 0%  (0/4 tasks)
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: [          ] 0%  (0/4 tasks)
Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: [          ] 0%  (0/4 tasks)

Overall: [==        ] 20%
```

### Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:
1. âš ï¸ ØªØ·Ø¨ÙŠÙ‚ RLS (ÙŠØ­ØªØ§Ø¬ ØªÙ†ÙÙŠØ°Ùƒ ÙÙŠ Supabase SQL Editor)
2. âœ… ØªÙ†Ø¸ÙŠÙ Console Logs (ØªÙ… ÙÙŠ Bookings, Payments, supabaseService)
3. â³ Ø­Ø°Ù Dead Code (Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°)
4. â³ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ø§Ù„ØªØ§Ù„ÙŠ)

---

## âš¡ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±ÙŠØ¹

### Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ - Ø§Ù„Ø¢Ù†:
```bash
# 1. ØªØ·Ø¨ÙŠÙ‚ RLS
# Ø§ÙØªØ­ Supabase SQL Editor
# Ø´ØºÙ‘Ù„: supabase-migrations/FIX-RLS-scheduled-payments.sql

# 2. ØªØ«Ø¨ÙŠØª dependencies Ø¬Ø¯ÙŠØ¯Ø©
npm install jspdf xlsx recharts jszip react-pdf

# 3. Ø§Ø¨Ø¯Ø£ Ø¨Ù€ Task 2.1 (Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±)
```

---

**Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:**
- ÙƒÙ„ task Ù„Ù‡ Ù…Ø¹Ø§ÙŠÙŠØ± Ù†Ø¬Ø§Ø­ ÙˆØ§Ø¶Ø­Ø©
- Ø§Ù„ØªÙ‚Ø¯ÙŠØ±Ø§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±Ø¹Ø©
- ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ° tasks Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø·ÙˆØ±
- Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ù…Ù„

---

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 18 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025
