# ูุธุงู ุงูุชุณุฏูุฏ ุงููุชุณูุณู ููุฃูุณุงุท

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู ุงูุชุณุฏูุฏ ุงููุชุณูุณู ููุฃูุณุงุท ูุถูุงู ุงูุฏูุน ุจุงูุชุฑุชูุจ ุงูุตุญูุญ ูุชุฌูุจ ุงูุฃุฎุทุงุก.

## ุงูููุงุนุฏ ุงูุฃุณุงุณูุฉ

### โ ูุงุนุฏุฉ ุงูุชุณูุณู

1. **ุงููุณุท ุงูุฃูู (#1)**: ุฏุงุฆูุงู ูุชุงุญ ููุชุณุฏูุฏ
2. **ุงููุณุท ุงูุซุงูู (#2)**: ูููุนูู ููุท ุจุนุฏ ุชุณุฏูุฏ ุงููุณุท #1
3. **ุงููุณุท ุงูุซุงูุซ (#3)**: ูููุนูู ููุท ุจุนุฏ ุชุณุฏูุฏ ุงููุณุท #2
4. **ูููุฐุง...** ุญุชู ุขุฎุฑ ูุณุท

### ๐ฏ ุงููุฏู

- โ ููุน ุชุณุฏูุฏ ูุณุท ูุชุฃุฎุฑ ูุจู ุงูุฃูุณุงุท ุงูุณุงุจูุฉ
- โ ููุน ุงูุฃุฎุทุงุก ูู ุชุฑุชูุจ ุงูุฏูุนุงุช
- โ ุถูุงู ุงูุชุณูุณู ุงูุตุญูุญ
- โ ุณูููุฉ ุงููุชุงุจุนุฉ ูุงููุฑุงุฌุนุฉ

## ููู ูุนูู ุงููุธุงูุ

### ุงููุงุฌูุฉ

ูู ูุณุท ูู ุฌุฏูู ุงูุฏูุนุงุช ูุญุชูู ุนูู:

#### 1. ุงูุฃูุณุงุท ุงููุฏููุนุฉ โ
```
ุฒุฑ: โ ูุฏููุน
ุงูุญุงูุฉ: ููุชูู
ุงูููู: ุฃุฎุถุฑ
```

#### 2. ุงูุฃูุณุงุท ุงููุชุงุญุฉ ููุชุณุฏูุฏ ๐ต
```
ุฒุฑ: ๐ต ุชุณุฏูุฏ
ุงูุญุงูุฉ: ูุดุท (Active)
ุงูููู: ุฃุฎุถุฑ ูุงุชุญ
ุงูุฅุฌุฑุงุก: ูููู ุงูุถุบุท ุนููู
```

#### 3. ุงูุฃูุณุงุท ุงูููููุฉ ๐
```
ุฒุฑ: ๐ ูููู
ุงูุญุงูุฉ: ุบูุฑ ูุดุท (Disabled)
ุงูููู: ุฑูุงุฏู
ุงูุฑุณุงูุฉ: "ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #X ุฃููุงู"
```

## ูุซุงู ุนููู

### ุงูุณููุงุฑูู:
ุนููู ูุฏูู 12 ูุณุท ุดูุฑู

#### ุงูุญุงูุฉ ุงูุฃูููุฉ (ูู ูุชู ุชุณุฏูุฏ ุฃู ูุณุท):
- โ **ุงููุณุท #1**: ุฒุฑ "ุชุณุฏูุฏ" ูุดุท
- ๐ ุงููุณุท #2: ูููู (ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #1 ุฃููุงู)
- ๐ ุงููุณุท #3: ูููู (ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #1 ุฃููุงู)
- ... ูููุฐุง

#### ุจุนุฏ ุชุณุฏูุฏ ุงููุณุท #1:
- โ **ุงููุณุท #1**: ูุฏููุน โ
- โ **ุงููุณุท #2**: ุฒุฑ "ุชุณุฏูุฏ" ูุดุท
- ๐ ุงููุณุท #3: ูููู (ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #2 ุฃููุงู)
- ... ูููุฐุง

#### ุจุนุฏ ุชุณุฏูุฏ ุงููุณุท #2:
- โ **ุงููุณุท #1**: ูุฏููุน โ
- โ **ุงููุณุท #2**: ูุฏููุน โ
- โ **ุงููุณุท #3**: ุฒุฑ "ุชุณุฏูุฏ" ูุดุท
- ๐ ุงููุณุท #4: ูููู (ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #3 ุฃููุงู)
- ... ูููุฐุง

## ุงูุชูููุฐ ุงูุชููู

### ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ: `canPayInstallment()`

```typescript
const canPayInstallment = (payment: ScheduledPayment): { canPay: boolean; reason?: string } => {
    // 1. ุงูุชุญูู ูู ุงูุญุงูุฉ ุงูุญุงููุฉ
    if (payment.status === 'paid') {
        return { canPay: false, reason: 'ุชู ุงูุฏูุน ุจุงููุนู' };
    }
    
    // 2. ุฌูุจ ุฌููุน ุฃูุณุงุท ููุณ ุงูุญุฌุฒ ูุฑุชุจุฉ
    const bookingPayments = scheduledPayments
        .filter(p => p.bookingId === payment.bookingId)
        .sort((a, b) => a.installmentNumber - b.installmentNumber);
    
    // 3. ุงููุณุท ุงูุฃูู ุฏุงุฆูุงู ูุชุงุญ
    if (payment.installmentNumber === 1) {
        return { canPay: true };
    }
    
    // 4. ุงูุชุญูู ูู ุงูุฃูุณุงุท ุงูุณุงุจูุฉ
    const previousPayments = bookingPayments.filter(
        p => p.installmentNumber < payment.installmentNumber
    );
    
    const allPreviousPaid = previousPayments.every(p => p.status === 'paid');
    
    // 5. ุฅุฐุง ูู ุชูุฏูุน ูู ุงูุฃูุณุงุท ุงูุณุงุจูุฉุ ุงููุณุท ูููู
    if (!allPreviousPaid) {
        const unpaidPrevious = previousPayments.find(p => p.status !== 'paid');
        return { 
            canPay: false, 
            reason: `ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #${unpaidPrevious?.installmentNumber} ุฃููุงู` 
        };
    }
    
    // 6. ูู ุงูุฃูุณุงุท ุงูุณุงุจูุฉ ูุฏููุนุฉุ ูููู ุชุณุฏูุฏ ูุฐุง ุงููุณุท
    return { canPay: true };
};
```

### ุงููุคุดุฑุงุช ุงูุจุตุฑูุฉ

#### ุฒุฑ ุงูุชุณุฏูุฏ ุงููุดุท
```tsx
<button className="bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30">
    ๐ต ุชุณุฏูุฏ
</button>
```

#### ุฒุฑ ุงูุชุณุฏูุฏ ุงููููู
```tsx
<button 
    disabled
    className="bg-slate-700/50 text-slate-500 cursor-not-allowed opacity-50"
>
    ๐ ูููู
</button>
<span className="text-xs text-amber-400">
    ูุฌุจ ุชุณุฏูุฏ ุงููุณุท #2 ุฃููุงู
</span>
```

## ุงูููุฒุงุช

### โ ุงูุฃูุงู
- ูุง ูููู ุชุณุฏูุฏ ูุณุท ูุจู ุงูุฃูุณุงุท ุงูุณุงุจูุฉ
- ููุน ุงูุฃุฎุทุงุก ุงูุจุดุฑูุฉ
- ุญูุงูุฉ ูู ุงูุชูุงุนุจ

### โ ุณูููุฉ ุงูุงุณุชุฎุฏุงู
- ูุงุฌูุฉ ูุงุถุญุฉ
- ุฑุณุงุฆู ุชูุถูุญูุฉ
- ูุคุดุฑุงุช ุจุตุฑูุฉ ููููุฉ

### โ ุงููุฑููุฉ
- ูุนูู ูุน ุฃู ุนุฏุฏ ูู ุงูุฃูุณุงุท
- ูุฏุนู ุฌููุน ุฃููุงุน ุฎุทุท ุงูุฏูุน
- ูุณุชูู ุนู ูู ุญุฌุฒ

## ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:

1. **ุฅูุดุงุก ุญุฌุฒ ูุน ุฎุทุฉ ุฏูุน**
   - ุฃูุดุฆ ุญุฌุฒ ุฌุฏูุฏ
   - ูุนูู ุฎุทุฉ ุงูุฏูุน (ูุซูุงู: 12 ูุณุท ุดูุฑู)
   - ุงุญูุธ

2. **ุงูุชุญูู ูู ุงููุณุท ุงูุฃูู**
   - ุงูุชุญ ุตูุญุฉ "ุฌุฏูู ุงูุฏูุนุงุช ุงููุณุชุญูุฉ"
   - ุชุญูู ูู ุฃู ุงููุณุท #1 ูู ุฒุฑ "ุชุณุฏูุฏ" ูุดุท
   - ุชุญูู ูู ุฃู ุฌููุน ุงูุฃูุณุงุท ุงูุฃุฎุฑู ููููุฉ

3. **ุชุณุฏูุฏ ุงููุณุท ุงูุฃูู**
   - ุงุถุบุท ุนูู ุฒุฑ "ุชุณุฏูุฏ" ูููุณุท #1
   - ุชุฃููุฏ ุงูุชุณุฏูุฏ
   - ุชุญูู ูู ุชุบููุฑ ุงูุญุงูุฉ ุฅูู "ูุฏููุน"

4. **ุงูุชุญูู ูู ุงููุณุท ุงูุซุงูู**
   - ุชุญูู ูู ุฃู ุงููุณุท #2 ุฃุตุจุญ ูุดุทุงู
   - ุชุญูู ูู ุฃู ุงููุณุท #3 ูุง ุฒุงู ููููุงู

5. **ุชูุฑุงุฑ ุงูุนูููุฉ**
   - ุณุฏูุฏ ุงููุณุท #2
   - ุชุญูู ูู ุชูุนูู ุงููุณุท #3
   - ูููุฐุง...

## ุงููููุงุช ุงููุนุฏููุฉ

- โ `components/pages/sales/ScheduledPayments.tsx`
  - ุฅุถุงูุฉ ุฏุงูุฉ `canPayInstallment()`
  - ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฌุฏูู
  - ุฅุถุงูุฉ ูุคุดุฑุงุช ุจุตุฑูุฉ

## ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุฌุฏูุฏ ูุถูู:
- โ ุชุณุฏูุฏ ุงูุฃูุณุงุท ุจุงูุชุฑุชูุจ ุงูุตุญูุญ
- โ ููุน ุงูุฃุฎุทุงุก ูุงูุชูุงุนุจ
- โ ูุงุฌูุฉ ูุงุถุญุฉ ูุณููุฉ ุงูุงุณุชุฎุฏุงู
- โ ุชุชุจุน ุฏููู ูุญุงูุฉ ูู ูุณุท
